<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Click Tracker</title>
</head>
<body>
  <h1>Tracked Links</h1>
  <p>Click any link below to track your IP and send the info to a webhook before redirecting.</p>
  
  <!-- Add the class "track-click" to any link you want to track -->
  <ul>
    <li><a href="https://example.com" class="track-click">Go to Example.com</a></li>
    <li><a href="https://openai.com" class="track-click">Go to OpenAI</a></li>
  </ul>

  <script>
    // TODO: Replace with your actual webhook URL
    const WEBHOOK_URL = 'https://n8n.excelogy.net/webhook/c3103877-3156-4c8c-8453-f0269a1d5330';

    // Function to fetch the client IP using a public API
    async function fetchClientIP() {
      try {
        const res = await fetch('https://api.ipify.org?format=json');
        const data = await res.json();
        return data.ip;
      } catch (err) {
        console.error('Failed to fetch IP:', err);
        return 'unknown';
      }
    }

    // Handler for tracked clicks
    async function handleTrackedClick(event) {
      event.preventDefault();
      const link = event.currentTarget;
      const targetUrl = link.href;

      const clientIP = await fetchClientIP();
      const payload = {
        ip: clientIP,
        url: targetUrl,
        userAgent: navigator.userAgent,
        timestamp: new Date().toISOString()
      };

      // Send tracking data to your webhook
      fetch(WEBHOOK_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      }).catch(err => console.error('Failed to send webhook:', err));

      // Redirect the user after tracking
      window.location.href = targetUrl;
    }

    // Attach handlers on DOM load
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('a.track-click').forEach(link => {
        link.addEventListener('click', handleTrackedClick);
      });
    });
  </script>
</body>
</html>
